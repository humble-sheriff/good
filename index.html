<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cute Cat Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff7fb;
      text-align: center;
      padding: 40px;
    }
    h1 {
      color: #ff66aa;
    }
    button {
      background: #ff66aa;
      color: white;
      padding: 10px 16px;
      margin: 6px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #ff3388;
    }
    img {
      margin-top: 20px;
      max-width: 80%;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    #gallery {
      margin-top: 40px;
    }
    .gallery-img {
      width: 150px;
      margin: 8px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
  <h1>🐱 Cute Cat Generator 🐾</h1>
  <button onclick="generateCat()">New Cat 😻</button>
  <button onclick="downloadCat()">Download ⬇️</button>
  <button onclick="likeCat()">❤️ Like</button>
  <button onclick="toggleSurprise()">🎲 Surprise Mode</button>
  <button onclick="toggleAuto()">⏳ Auto Refresh</button>
  <button onclick="clearLiked()">🗑️ Clear Liked</button>

  <div>
    <img id="catImage" src="" alt="Your cat will appear here!">
  </div>

  <div id="gallery">
    <h2>❤️ Your Liked Cats</h2>
    <div id="likedCats"></div>
  </div>

  <script>
    const GEMINI_KEY = "AIzaSyCQyNfJRifhZe2f3kL2UJXxTOcazIBUqnc"; // replace with your Gemini key
    let currentCatUrl = "";
    let surpriseMode = false;
    let autoRefresh = null;

    const loadingMessages = [
      "🐾 Chasing cats...",
      "😺 Petting whiskers...",
      "🐱 Meow-tastic loading...",
      "😻 Cuteness incoming...",
      "🐈 Rolling in catnip..."
    ];

    async function generateCat() {
      const imgElement = document.getElementById("catImage");
      imgElement.alt = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
      currentCatUrl = "";

      // 🎲 Surprise mode
      if (surpriseMode && Math.random() < 0.3) {
        const funnyCats = [
          "https://i.imgur.com/JqEuJ6t.jpeg", // cat meme
          "https://i.imgur.com/n8OYCzR.gif",  // funny cat gif
          "https://i.imgur.com/z4d4kWk.jpeg", // grumpy cat
          "https://i.imgur.com/R2rSdj9.jpeg", // cute puppy
        ];
        currentCatUrl = funnyCats[Math.floor(Math.random() * funnyCats.length)];
        imgElement.src = currentCatUrl;
        imgElement.alt = "🎲 Surprise!";
        return;
      }

      try {
        // Try Gemini for a cat photo URL
        const geminiRes = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" + GEMINI_KEY,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: "Give me a direct link to a random cute cat photo." }] }]
            })
          }
        );
        const data = await geminiRes.json();
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";
        const urlMatch = text.match(/(https?:\/\/\S+\.(jpg|jpeg|png|gif))/i);

        if (urlMatch) {
          currentCatUrl = urlMatch[0];
          imgElement.src = currentCatUrl;
          imgElement.alt = "Cute cat!";
          return;
        }
      } catch (e) {
        console.error("Gemini failed", e);
      }

      // 🔄 Fallback: TheCatAPI
      try {
        const fallbackRes = await fetch("https://api.thecatapi.com/v1/images/search");
        const fallbackData = await fallbackRes.json();
        currentCatUrl = fallbackData[0].url;
        imgElement.src = currentCatUrl;
        imgElement.alt = "Cute fallback cat!";
      } catch (e) {
        imgElement.alt = "❌ Could not load cat.";
      }
    }

    // ✅ Proper download using blob
    async function downloadCat() {
      if (!currentCatUrl) return alert("No cat yet! Generate one first 😺");
      try {
        const res = await fetch(currentCatUrl);
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "cute-cat.jpg";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        URL.revokeObjectURL(url);
      } catch (e) {
        alert("❌ Failed to download cat.");
      }
    }

    // ❤️ Like current cat
    function likeCat() {
      if (!currentCatUrl) return alert("No cat yet! Generate one first 😺");
      const likedCats = document.getElementById("likedCats");
      const img = document.createElement("img");
      img.src = currentCatUrl;
      img.className = "gallery-img";
      likedCats.appendChild(img);
    }

    // 🗑️ Clear liked cats
    function clearLiked() {
      document.getElementById("likedCats").innerHTML = "";
    }

    // 🎲 Toggle surprise mode
    function toggleSurprise() {
      surpriseMode = !surpriseMode;
      alert("🎲 Surprise mode " + (surpriseMode ? "ON" : "OFF"));
    }

    // ⏳ Auto refresh every 10s
    function toggleAuto() {
      if (autoRefresh) {
        clearInterval(autoRefresh);
        autoRefresh = null;
        alert("⏳ Auto refresh OFF");
      } else {
        autoRefresh = setInterval(generateCat, 10000);
        alert("⏳ Auto refresh ON (every 10s)");
      }
    }

    // Load one cat at start
    window.onload = generateCat;
  </script>
</body>
</html>
